name: Tests de non-rÃ©gression

# L'action s'activera Ã  chaque push sur le repository
on: [push]

jobs:
  test-job:
    # On tourne sur une machine ubuntu
    runs-on: ubuntu-latest

    # On donne un nom Ã  notre job
    name: Execute tests

    steps:
      - name: ğŸ›‘ Annule les prÃ©cÃ©dents workflows
        uses: styfle/cancel-workflow-action@0.9.1
      - name: â¬‡ï¸ RÃ©cupÃ¨re le repository
        uses: actions/checkout@v4
      - name: ğŸ›  Installe la bonne version de node
        # On install node v18
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: ğŸ“± Installe les dÃ©pendances
        # npm ci, prends les dÃ©pendances du package-lock.json et non du package.json
        # Ainsi on se base sur les derniÃ¨res dÃ©pendances installÃ©es en local
        run: npm ci
      - name: âœ… Executer tests
        run: npm test

  build-job:
    # On tourne sur une machine ubuntu
    runs-on: ubuntu-latest

    # On donne un nom Ã  notre job
    name: Build l'application

    # Execute seulement si les tests sont passÃ©s
    needs: [test-job]

    steps:
      - name: â¬‡ï¸ RÃ©cupÃ¨re le repository
        uses: actions/checkout@v4
      - name: ğŸ›  Installe la bonne version de node
        # On install node v18
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: ğŸ“± Installe les dÃ©pendances
        # npm ci, prends les dÃ©pendances du package-lock.json et non du package.json
        # Ainsi on se base sur les derniÃ¨res dÃ©pendances installÃ©es en local
        run: npm ci
      - name: âœ… Executer tests
        run: npm test
